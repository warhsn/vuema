"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),w=require("./field-error.vue_vue_type_script_setup_true_lang-DddrtrU-.cjs"),S=require("./index-CrXYxxD8.cjs"),D=["multiple","accept"],M={class:"drag-drop-content"},b={key:0,class:"drag-drop-prompt"},F={key:0,class:"drag-drop-help"},U={key:1,class:"file-list"},z={class:"file-info"},$={class:"file-name"},H={class:"file-size"},I={key:0,class:"file-progress"},L=["value"],q={class:"file-status"},A={key:0,class:"tag is-success is-small"},O={key:1,class:"tag is-danger is-small"},P={key:2,class:"tag is-info is-small"},x=["onClick"],R={key:1,class:"field is-grouped mt-3"},J={class:"control"},G=["disabled"],K={class:"control"},X=["disabled"],Z=e.defineComponent({__name:"drag-drop-uploader",props:{endpoint:{},accepts:{default:"*/*"},uploadButtonText:{default:"Upload"},multiple:{type:Boolean,default:!0},additionalData:{},headers:{},classes:{},disabled:{type:Boolean},forLabel:{},modelValue:{type:[Boolean,Number,String,Array,Date]},placeholder:{},required:{type:Boolean},isLoading:{type:Boolean},isRounded:{type:Boolean},autocomplete:{type:Boolean},icon:{},iconType:{},iconPack:{},textIcon:{type:Boolean},leftIcon:{},iconClasses:{},leftIconClass:{},leftIconType:{},rightIconClass:{},rightIcon:{},rightIconType:{},error:{},hasAddons:{type:Boolean},isNormal:{type:Boolean},isSmall:{type:Boolean},isMedium:{type:Boolean},isLarge:{type:Boolean},isResponsive:{type:Boolean},isExpanded:{type:Boolean},isFullwidth:{type:Boolean},is0:{type:Boolean},is1:{type:Boolean},is2:{type:Boolean},is3:{type:Boolean},is4:{type:Boolean},is5:{type:Boolean},is6:{type:Boolean},is7:{type:Boolean},is8:{type:Boolean},is9:{type:Boolean},is10:{type:Boolean},is11:{type:Boolean},is12:{type:Boolean}},emits:["filesSelected","uploadProgress","file-uploaded","upload-error","upload-completed","upload-failed"],setup(g,{emit:y}){const i=g,n=e.ref([]),u=e.ref(!1),c=e.ref(!1),f=e.ref(),p=y;function h(o){o.dataTransfer&&(o.dataTransfer.dropEffect="copy"),u.value=!0}function B(){u.value=!1}function v(o){var a;if(u.value=!1,(a=o.dataTransfer)!=null&&a.files){const s=Array.from(o.dataTransfer.files);m(s)}}function E(){var o;(o=f.value)==null||o.click()}function k(o){const a=o.target;if(a.files){const s=Array.from(a.files);m(s)}}function m(o){const a=o.filter(t=>!n.value.some(r=>r.name===t.name&&r.size===t.size)),s=a.map(t=>({file:t,name:t.name,size:t.size,progress:0,isUploading:!1,isComplete:!1,hasError:!1}));i.multiple?n.value.push(...s):n.value=s.slice(0,1),p("filesSelected",a)}function _(o){n.value.splice(o,1)}function C(){n.value=[]}async function N(){if(!i.endpoint)return;c.value=!0;const o=[],a=[];try{for(const s of n.value)if(!s.isComplete){s.isUploading=!0,s.hasError=!1;try{const t=await V(s);s.isComplete=!0,s.isUploading=!1,o.push(t),p("file-uploaded",{file:s.file,response:t})}catch(t){s.hasError=!0,s.isUploading=!1,s.errorMessage=t instanceof Error?t.message:"Upload failed",a.push({file:s.file,error:s.errorMessage}),p("upload-error",{file:s.file,error:s.errorMessage})}}a.length===0&&o.length>0?p("upload-completed",o):a.length>0&&p("upload-failed",a)}finally{c.value=!1}}async function V(o){return new Promise((a,s)=>{const t=new FormData;t.append("file",o.file),i.additionalData&&Object.entries(i.additionalData).forEach(([l,d])=>{t.append(l,String(d))});const r=new XMLHttpRequest;r.upload.addEventListener("progress",l=>{l.lengthComputable&&(o.progress=Math.round(l.loaded/l.total*100),p("uploadProgress",{file:o.file,progress:o.progress}))}),r.addEventListener("load",()=>{if(r.status>=200&&r.status<300)try{const l=JSON.parse(r.responseText);if(l.errors||l.error||l.validationErrors){const d=l.message||l.error||(l.errors?JSON.stringify(l.errors):"Validation failed");s(new Error(d))}else a(l)}catch{a(r.responseText)}else if(r.status>=400&&r.status<500)try{const l=JSON.parse(r.responseText),d=l.message||l.error||(l.errors?JSON.stringify(l.errors):`HTTP ${r.status}: ${r.statusText}`);s(new Error(d))}catch{s(new Error(`HTTP ${r.status}: ${r.statusText}`))}else s(new Error(`HTTP ${r.status}: ${r.statusText}`))}),r.addEventListener("error",()=>{s(new Error("Network error occurred"))}),r.open("POST",i.endpoint),i.headers&&Object.entries(i.headers).forEach(([l,d])=>{r.setRequestHeader(l,d)}),r.send(t)})}function T(o){if(o===0)return"0 Bytes";const a=1024,s=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(o)/Math.log(a));return parseFloat((o/Math.pow(a,t)).toFixed(2))+" "+s[t]}return(o,a)=>{const s=e.resolveComponent("field-label");return e.openBlock(),e.createElementBlock("div",null,[o.$slots.default||o.$slots.description?(e.openBlock(),e.createBlock(s,{key:0,required:o.required},{description:e.withCtx(()=>[e.renderSlot(o.$slots,"description",{},void 0,!0)]),default:e.withCtx(()=>[e.renderSlot(o.$slots,"default",{},void 0,!0)]),_:3},8,["required"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["drag-drop-uploader",{"is-dragover":u.value,"is-uploading":c.value,"has-files":n.value.length>0}]),onDragover:e.withModifiers(h,["prevent"]),onDragleave:e.withModifiers(B,["prevent"]),onDrop:e.withModifiers(v,["prevent"]),onClick:E},[e.createElementVNode("input",{ref_key:"fileInput",ref:f,type:"file",multiple:o.multiple,accept:o.accepts,onChange:k,style:{display:"none"}},null,40,D),e.createElementVNode("div",M,[n.value.length===0?(e.openBlock(),e.createElementBlock("div",b,[a[0]||(a[0]=e.createElementVNode("svg",{class:"drag-drop-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e.createElementVNode("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1)),a[1]||(a[1]=e.createElementVNode("p",{class:"drag-drop-text"},[e.createElementVNode("strong",null,"Click to upload"),e.createTextVNode(" or drag and drop files here ")],-1)),o.accepts?(e.openBlock(),e.createElementBlock("p",F," Accepted formats: "+e.toDisplayString(o.accepts),1)):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("div",U,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(t,r)=>(e.openBlock(),e.createElementBlock("div",{key:r,class:e.normalizeClass(["file-item",{"is-uploading":t.isUploading,"is-success":t.isComplete,"is-error":t.hasError}])},[e.createElementVNode("div",z,[e.createElementVNode("span",$,e.toDisplayString(t.name),1),e.createElementVNode("span",H,e.toDisplayString(T(t.size)),1)]),t.isUploading?(e.openBlock(),e.createElementBlock("div",I,[e.createElementVNode("progress",{class:"progress is-small is-primary",value:t.progress,max:"100"},e.toDisplayString(t.progress)+"% ",9,L)])):e.createCommentVNode("",!0),e.createElementVNode("div",q,[t.isComplete?(e.openBlock(),e.createElementBlock("span",A," Complete ")):t.hasError?(e.openBlock(),e.createElementBlock("span",O," Error ")):t.isUploading?(e.openBlock(),e.createElementBlock("span",P,e.toDisplayString(t.progress)+"% ",1)):e.createCommentVNode("",!0)]),t.isUploading?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:1,class:"delete is-small",onClick:e.withModifiers(l=>_(r),["stop"])},null,8,x))],2))),128))]))])],34),n.value.length>0?(e.openBlock(),e.createElementBlock("div",R,[e.createElementVNode("div",J,[e.createElementVNode("button",{class:e.normalizeClass(["button is-primary",{"is-loading":c.value}]),onClick:N,disabled:c.value||!o.endpoint},e.toDisplayString(o.uploadButtonText),11,G)]),e.createElementVNode("div",K,[e.createElementVNode("button",{class:"button",onClick:C,disabled:c.value}," Clear ",8,X)])])):e.createCommentVNode("",!0),e.createVNode(w._sfc_main,{error:o.error},null,8,["error"])])}}}),Q=S._export_sfc(Z,[["__scopeId","data-v-3e6a78f5"]]);exports.default=Q;
