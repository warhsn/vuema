"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("vue"),w=require("./field-error.vue_vue_type_script_setup_true_lang-DddrtrU-.cjs"),S=require("./index-Cs1ZbfIF.cjs"),D=["multiple","accept"],M={class:"drag-drop-content"},b={key:0,class:"drag-drop-prompt"},x={key:0,class:"drag-drop-help"},F={key:1,class:"file-list"},U={class:"file-info"},z={class:"file-name"},O={class:"file-size"},$={key:0,class:"file-progress"},H=["value"],I={class:"file-status"},L={key:0,class:"tag is-success is-small"},q={key:1,class:"tag is-danger is-small"},A={key:2,class:"tag is-info is-small"},P=["onClick"],R={key:1,class:"field is-grouped mt-3"},J={class:"control"},G=["disabled"],K={class:"control"},X=["disabled"],Z=e.defineComponent({__name:"drag-drop-uploader",props:{endpoint:{},accepts:{default:"*/*"},uploadButtonText:{default:"Upload"},multiple:{type:Boolean,default:!0},additionalData:{},headers:{},clearOnSuccess:{type:Boolean,default:!1},classes:{},disabled:{type:Boolean},forLabel:{},modelValue:{type:[Boolean,Number,String,Array,Date]},placeholder:{},required:{type:Boolean},isLoading:{type:Boolean},isRounded:{type:Boolean},autocomplete:{type:Boolean},icon:{},iconType:{},iconPack:{},textIcon:{type:Boolean},leftIcon:{},iconClasses:{},leftIconClass:{},leftIconType:{},rightIconClass:{},rightIcon:{},rightIconType:{},error:{},hasAddons:{type:Boolean},isNormal:{type:Boolean},isSmall:{type:Boolean},isMedium:{type:Boolean},isLarge:{type:Boolean},isResponsive:{type:Boolean},isExpanded:{type:Boolean},isFullwidth:{type:Boolean},is0:{type:Boolean},is1:{type:Boolean},is2:{type:Boolean},is3:{type:Boolean},is4:{type:Boolean},is5:{type:Boolean},is6:{type:Boolean},is7:{type:Boolean},is8:{type:Boolean},is9:{type:Boolean},is10:{type:Boolean},is11:{type:Boolean},is12:{type:Boolean}},emits:["files-selected","file-added","upload-progress","file-uploaded","upload-error","upload-completed","upload-failed"],setup(i,{emit:h}){const c=i,n=e.ref([]),f=e.ref(!1),p=e.ref(!1),m=e.ref(),u=h;function B(t){t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),f.value=!0}function v(){f.value=!1}function E(t){var a;if(f.value=!1,(a=t.dataTransfer)!=null&&a.files){const s=Array.from(t.dataTransfer.files);g(s)}}function k(){var t;(t=m.value)==null||t.click()}function _(t){const a=t.target;if(a.files){const s=Array.from(a.files);g(s)}}function g(t){const a=t.filter(o=>!n.value.some(r=>r.name===o.name&&r.size===o.size)),s=a.map(o=>({file:o,name:o.name,size:o.size,progress:0,isUploading:!1,isComplete:!1,hasError:!1}));c.multiple?n.value.push(...s):n.value=s.slice(0,1),u("files-selected",a)}function C(t){n.value.splice(t,1)}function y(){n.value=[]}async function N(){if(!c.endpoint)return;p.value=!0;const t=[],a=[];try{for(const s of n.value)if(!s.isComplete){s.isUploading=!0,s.hasError=!1;try{const o=await V(s);s.isComplete=!0,s.isUploading=!1,t.push(o),u("file-uploaded",{file:s.file,response:o})}catch(o){s.hasError=!0,s.isUploading=!1,s.errorMessage=o instanceof Error?o.message:"Upload failed",a.push({file:s.file,error:s.errorMessage}),u("upload-error",{file:s.file,error:s.errorMessage})}}a.length===0&&t.length>0?(u("upload-completed",t),c.clearOnSuccess&&y()):a.length>0&&u("upload-failed",a)}finally{p.value=!1}}async function V(t){return new Promise((a,s)=>{const o=new FormData;o.append("file",t.file),c.additionalData&&Object.entries(c.additionalData).forEach(([l,d])=>{o.append(l,String(d))});const r=new XMLHttpRequest;r.upload.addEventListener("progress",l=>{l.lengthComputable&&(t.progress=Math.round(l.loaded/l.total*100),u("upload-progress",{file:t.file,progress:t.progress}))}),r.addEventListener("load",()=>{if(r.status>=200&&r.status<300)try{const l=JSON.parse(r.responseText);if(l.errors||l.error||l.validationErrors){const d=l.message||l.error||(l.errors?JSON.stringify(l.errors):"Validation failed");s(new Error(d))}else a(l)}catch{a(r.responseText)}else if(r.status>=400&&r.status<500)try{const l=JSON.parse(r.responseText),d=l.message||l.error||(l.errors?JSON.stringify(l.errors):`HTTP ${r.status}: ${r.statusText}`);s(new Error(d))}catch{s(new Error(`HTTP ${r.status}: ${r.statusText}`))}else s(new Error(`HTTP ${r.status}: ${r.statusText}`))}),r.addEventListener("error",()=>{s(new Error("Network error occurred"))}),r.open("POST",c.endpoint),c.headers&&Object.entries(c.headers).forEach(([l,d])=>{r.setRequestHeader(l,d)}),r.send(o)})}function T(t){if(t===0)return"0 Bytes";const a=1024,s=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,o)).toFixed(2))+" "+s[o]}return(t,a)=>{const s=e.resolveComponent("field-label");return e.openBlock(),e.createElementBlock("div",null,[t.$slots.default||t.$slots.description?(e.openBlock(),e.createBlock(s,{key:0,required:i.required},{description:e.withCtx(()=>[e.renderSlot(t.$slots,"description",{},void 0,!0)]),default:e.withCtx(()=>[e.renderSlot(t.$slots,"default",{},void 0,!0)]),_:3},8,["required"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["drag-drop-uploader",{"is-dragover":f.value,"is-uploading":p.value,"has-files":n.value.length>0}]),onDragover:e.withModifiers(B,["prevent"]),onDragleave:e.withModifiers(v,["prevent"]),onDrop:e.withModifiers(E,["prevent"]),onClick:k},[e.createElementVNode("input",{ref_key:"fileInput",ref:m,type:"file",multiple:i.multiple,accept:i.accepts,onChange:_,style:{display:"none"}},null,40,D),e.createElementVNode("div",M,[n.value.length===0?(e.openBlock(),e.createElementBlock("div",b,[a[0]||(a[0]=e.createElementVNode("svg",{class:"drag-drop-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e.createElementVNode("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1)),a[1]||(a[1]=e.createElementVNode("p",{class:"drag-drop-text"},[e.createElementVNode("strong",null,"Click to upload"),e.createTextVNode(" or drag and drop files here ")],-1)),i.accepts?(e.openBlock(),e.createElementBlock("p",x," Accepted formats: "+e.toDisplayString(i.accepts),1)):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("div",F,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(o,r)=>(e.openBlock(),e.createElementBlock("div",{key:r,class:e.normalizeClass(["file-item",{"is-uploading":o.isUploading,"is-success":o.isComplete,"is-error":o.hasError}])},[e.createElementVNode("div",U,[e.createElementVNode("span",z,e.toDisplayString(o.name),1),e.createElementVNode("span",O,e.toDisplayString(T(o.size)),1)]),o.isUploading?(e.openBlock(),e.createElementBlock("div",$,[e.createElementVNode("progress",{class:"progress is-small is-primary",value:o.progress,max:"100"},e.toDisplayString(o.progress)+"% ",9,H)])):e.createCommentVNode("",!0),e.createElementVNode("div",I,[o.isComplete?(e.openBlock(),e.createElementBlock("span",L," Complete ")):o.hasError?(e.openBlock(),e.createElementBlock("span",q," Error ")):o.isUploading?(e.openBlock(),e.createElementBlock("span",A,e.toDisplayString(o.progress)+"% ",1)):e.createCommentVNode("",!0)]),o.isUploading?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:1,class:"delete is-small",onClick:e.withModifiers(l=>C(r),["stop"])},null,8,P))],2))),128))]))])],34),n.value.length>0?(e.openBlock(),e.createElementBlock("div",R,[e.createElementVNode("div",J,[e.createElementVNode("button",{class:e.normalizeClass(["button is-primary",{"is-loading":p.value}]),onClick:N,disabled:p.value||!i.endpoint},e.toDisplayString(i.uploadButtonText),11,G)]),e.createElementVNode("div",K,[e.createElementVNode("button",{class:"button",onClick:y,disabled:p.value}," Clear ",8,X)])])):e.createCommentVNode("",!0),e.createVNode(w._sfc_main,{error:i.error},null,8,["error"])])}}}),Q=S._export_sfc(Z,[["__scopeId","data-v-acb25dec"]]);exports.default=Q;
